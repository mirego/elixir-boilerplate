# Use Ubuntu Xenial
dist: xenial

# Elixir baby!
language: elixir

elixir: 1.9
otp_release: 22.0.7

# Make sure PostgreSQL is running
addons:
  postgresql: 10

# Use the cache to build faster
cache:
  directories:
    - _build
    - deps
    - assets/node_modules
    - priv/plts

# Set global environment variables
env:
  global:
    - MIX_ENV: test
    - DATABASE_URL: postgres://localhost/elixir_boilerplate_test
    - PORT: 4000
    - SECRET_KEY_BASE: 6Z6Tv8zu0vg+D9I7WU6e7sl0HMqvq1lXDDodLTLSZogGGfwPSoNJHCyipz7XVNbi
    - SESSION_KEY: elixir_boilerplate
    - SIGNING_SALT: /gdYXAjk3FYyLWrL+CQCzuTEmmyouMYZp1BzYq2RNZQo4bKb1yelp5MwLzq3Zd5I

# Install the node version we need, install the node packages,
# create the database and prepare the application
before_script:
  - nvm install 10.14.2
  - nvm use 10.14.2
  - npm --prefix assets ci
  - mix compile
  - mix ecto.create
  - mix ecto.migrate

script:
  - ./priv/scripts/ci-check.sh
